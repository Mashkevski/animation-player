!function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0),n(1);function o(e,t={}){const n=document.createElement(e);return Object.assign(n,t),n}n(2),n(3);class s{constructor({width:e,height:t,scale:n}){const s=o("canvas",{width:e,height:t});this.scale=n,this.node=s,this.pixels=[],this.clear()}draw(){const{node:e,pixels:t,scale:n}=this,o=this.node.width/n,s=e.getContext("2d");for(let e=0;e<n;e+=1){const c=e*o;for(let e=0;e<n;e+=1){const a=e*o;s.fillStyle=t[c/o*n+a/o]||"#00000000",s.fillRect(a,c,o,o)}}}clear(){const{node:e}=this;e.getContext("2d").clearRect(0,0,e.width,e.height)}}class c{constructor({number:e,scale:t}){const n=document.createElement("li"),o=new s({width:100,height:100,scale:t});n.className="frame",n.innerHTML=`\n        <div class="number">${e}</div>\n        <button class="delete">del</button>\n        <button class="duplicate">copy</button>`,n.appendChild(o.node),this.picture=o,this.node=n}}n(4);class a{constructor(e,t){const n=o("section",{className:"preview"}),c=o("input",{min:1,max:24,value:12,step:1,type:"range"}),l=new s({width:200,height:200,scale:t});l.node.addEventListener("dblclick",()=>{l.node.requestFullscreen()});const r=o("span",{className:"fps-count",textContent:12});n.append(l.node,c,r),a.animateCanvas({fpsInput:c,frames:e,canvas:l}),this.fpsCount=r,this.fpsInput=c,this.node=n}static animateCanvas({fpsInput:e,frames:t,canvas:n}){const o=n;let s=performance.now(),c=0;requestAnimationFrame(function n(a){a-s>1e3/e.value&&c<t.length&&(o.pixels=t[c].picture.pixels.slice(),o.clear(),o.draw(),s=a,c+=1),c>=t.length&&(c=0),requestAnimationFrame(n)})}}const l=16,r={77:"move",84:"transform",66:"bucket",67:"color-choose"},i=document.querySelector(".new-canvas-wrapper"),d=new s({width:800,height:800,scale:l});i.appendChild(d.node);const u=document.querySelector(".animation-wrapper");const m=new class{constructor(e,t){const n=document.createElement("ul");n.className="frames-list";const o=new c({number:1,scale:t});n.appendChild(o.node),this.scale=t,this.updateMainCanvas=e,this.frames=[o],this.node=n,this.setActiveFrame(o.node)}setActiveFrame(e){this.activeFrameNode&&this.activeFrameNode.classList.toggle("active"),e.classList.contains("active")||e.classList.add("active"),this.activeFrameNode=e;const{frames:t}=this,n=t.findIndex(t=>t.node===e);this.activeFrame=t[n],this.updateMainCanvas(this.activeFrame.picture.pixels)}updateContent(){const{children:e}=this.node;[].forEach.call(e,(e,t)=>{e.querySelector(".number").textContent=t+1})}add(){const{node:e,frames:t,scale:n}=this,o=new c({number:e.childElementCount+1,scale:n});t.push(o),e.appendChild(o.node),this.setActiveFrame(o.node)}delete(e){if(e.parentElement.childElementCount>1){const{activeFrameNode:t,frames:n}=this;e===t&&e.previousElementSibling?this.setActiveFrame(e.previousElementSibling):e===t&&this.setActiveFrame(e.nextElementSibling);const o=n.findIndex(t=>t.node===e);n.splice(o,1),e.parentElement.removeChild(e),this.updateContent()}}copy(e){const{frames:t,scale:n}=this,o=new c({number:1,scale:n}),s=t.findIndex(t=>t.node===e);t.splice(s+1,0,o),e.after(o.node),this.updateContent(),o.picture.pixels=t[s].picture.pixels.slice(),o.picture.draw(),this.setActiveFrame(o.node)}}(function(e){d.clear(),d.pixels=e.slice(),d.draw()},l),p=o("button",{className:"add-frame",textContent:"Add frame"});p.addEventListener("click",()=>{m.add()});const f=d.node.offsetWidth/l,v=new a(m.frames,l);function h(e){const t=d.node.getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top;return{x:n-n%f,y:o-o%f}}function y({x:e,y:t}){const n=d.node.getContext("2d");n.fillStyle="blue",n.fillRect(e,t,f,f),d.pixels[t/f*l+e/f]="blue"}v.fpsInput.addEventListener("input",e=>{v.fpsCount.textContent=e.target.value});let g={x:0,y:0};function b(e){const t=h(e);t.x===g.x&&t.y===g.y||(g=t,y(t))}function w(){m.activeFrame.picture.pixels=d.pixels.slice(),m.activeFrame.picture.draw(),d.node.removeEventListener("mousemove",b),document.removeEventListener("mouseup",w)}d.node.addEventListener("mousedown",function(e){y(h(e)),d.node.addEventListener("mousemove",b),document.addEventListener("mouseup",w)}),m.node.addEventListener("click",function(e){let{target:t}=e;if("delete"===t.className)m.delete(t.parentElement);else if("duplicate"===t.className)m.copy(t.parentElement);else for(;"frames-list"!==t.className;){if("frame"===t.className)return void m.setActiveFrame(t);t=t.parentNode}}),u.append(v.node,m.node,p);const x=document.querySelector(".tools"),C=document.querySelector(".colors"),L=document.querySelector(".canvas"),S=C.querySelector(".current .color-sample"),E=C.querySelector(".prev .color-sample");let k=null,N=null,F="";const $=[...L.querySelectorAll(".figure")];let q=null,O={current:"#008000",prev:"#008000"};const A={canvas:window.localStorage.getItem("canvas"),colors:window.localStorage.getItem("colors")};function I(e,t){window.localStorage.removeItem(e),window.localStorage.setItem(e,JSON.stringify(t))}function T(){return $.map(e=>({left:`${e.offsetLeft}px`,top:`${e.offsetTop}px`,width:`${e.offsetWidth}px`,height:`${e.offsetHeight}px`,backgroundColor:window.getComputedStyle(e).backgroundColor,className:e.className,position:"absolute"}))}function j(){const e=window.getComputedStyle(k).backgroundColor,t=window.getComputedStyle(S).backgroundColor;t!==e&&(E.style.backgroundColor=t,O.prev=t,S.style.backgroundColor=e,O.current=e),I("colors",O)}const M={x:0,y:0};let P=null,_=null;function X(e){(P=function(e){k.style.display="none";const t=document.elementFromPoint(e.clientX,e.clientY);return k.style.display="",null===t?null:t.closest(".figure")}(e))&&P.classList.add("over"),_&&_!==P&&_.classList.remove("over"),_=P}const Y=e=>{const t=M.x-e.clientX,n=M.y-e.clientY;M.x=e.clientX,M.y=e.clientY;const o=k.offsetLeft-t,s=k.offsetTop-n;k.style.left=`${o}px`,k.style.top=`${s}px`,X(e)},R=()=>{P&&(k.style.left=`${P.offsetLeft}px`,k.style.top=`${P.offsetTop}px`,P.style.left=`${N.left}px`,P.style.top=`${N.top}px`,_.classList.remove("over")),I("canvas",T()),document.removeEventListener("mousemove",Y),document.removeEventListener("mouseup",R)};C.addEventListener("click",e=>{"color-choose"===F&&(k=e.target,j())}),x.addEventListener("click",e=>{const t=e.target;"BUTTON"===t.tagName&&(F=t.dataset.action,document.body.className=`${F}-cursor`)}),document.addEventListener("keydown",e=>{82===e.keyCode?(window.localStorage.clear(),document.location.reload(!0)):27===e.keyCode?(F=null,document.body.className=""):r[e.keyCode]&&(F=r[e.keyCode],document.body.className=`${F}-cursor`)}),L.addEventListener("mousedown",e=>{switch(k=e.target,F){case"bucket":!function(){let e="";k.classList.contains("figure")&&(e=window.getComputedStyle(S).backgroundColor,k.style.backgroundColor=e),I("canvas",T())}();break;case"color-choose":j();break;case"transform":k.classList.contains("figure")&&k.classList.toggle("circle"),I("canvas",T());break;case"move":!function(e){k.classList.contains("figure")&&(N={left:k.offsetLeft,top:k.offsetTop},M.x=e.clientX,M.y=e.clientY,document.addEventListener("mousemove",Y),document.addEventListener("mouseup",R))}(e)}}),A.canvas?q=JSON.parse(A.canvas):I("canvas",q=T()),A.colors&&(O=JSON.parse(A.colors)),function(){for(let e=0;e<$.length;e+=1)$[e].style.left=q[e].left,$[e].style.top=q[e].top,$[e].style.position="absolute",$[e].style.width=q[e].width,$[e].style.height=q[e].height,$[e].style.backgroundColor=q[e].backgroundColor,$[e].className=q[e].className}(),S.style.backgroundColor=O.current,E.style.backgroundColor=O.prev}]);